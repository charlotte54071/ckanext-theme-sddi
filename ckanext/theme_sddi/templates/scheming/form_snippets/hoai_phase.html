<div class="form-group">
  <label for="field-hoai_phase">HOAI Service Phase</label>
  <select id="field-hoai_phase" name="hoai_phase" class="form-control">
    <option value="">-- Select HOAI Phase --</option>
    <option value="LPH 1">LPH 1 – Basic Evaluation</option>
    <option value="LPH 2">LPH 2 – Preliminary Design</option>
    <option value="LPH 3">LPH 3 – Design Planning</option>
    <option value="LPH 4">LPH 4 – Approval Planning</option>
    <option value="LPH 5">LPH 5 – Construction Drawings</option>
    <option value="LPH 6">LPH 6 – Tender Preparation</option>
    <option value="LPH 7">LPH 7 – Tender Support</option>
    <option value="LPH 8">LPH 8 – Site Supervision</option>
    <option value="LPH 9">LPH 9 – Operation Support</option>
  </select>
</div>

<script type="text/javascript">
  require(['jquery'], function($) {
    // DOM ready
    $(function() {
      const map = {
        'pre-construction':['LPH 1','LPH 2','LPH 6','LPH 7'],
        'survey':['LPH 1'],
        'design':['LPH 3','LPH 4','LPH 5'],
        'construction':['LPH 8'],
        'operation':['LPH 9'],
        'retirement':[]
      };
      function update() {
        const sel = $('#field-lifecycle_phase').val()||'';
        const allow = map[sel]||[];
        $('#field-hoai_phase option').each(function(){
          if(!this.value) return;
          $(this).toggle(allow.includes(this.value));
        });
        if (!allow.includes($('#field-hoai_phase').val())) {
          $('#field-hoai_phase').val('');
        }
      }
      // 只在字段都存在时绑定
      if ($('#field-lifecycle_phase').length && $('#field-hoai_phase').length) {
        update();
        $('#field-lifecycle_phase').on('change', update);
      }
    });
  });
</script>
