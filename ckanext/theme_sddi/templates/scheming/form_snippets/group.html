{% import 'macros/form.html' as form %}

<hr>

<script>

function show_checkboxes(a, show_checkboxes_after_checking=true){

	// get the currently selected group-name from the activated dropdown
	var selected_value = a.parentNode.childNodes[1].childNodes[0].childNodes[1].innerText;
	
	// get all checkboxes on the page
	var checkboxes = document.querySelectorAll("[type=checkbox]");
	
	// iterate over all checkboxes
	for(var i = 0; i < checkboxes.length; i++){
	
		// only do stuff with checkboxes that are related to the groups, not other checkboses from other scheming parts
		if(checkboxes[i].id.includes("field-group-")){

			// uncheck the main-category checkboxes so only one main category is checked
			if(!show_checkboxes_after_checking && parseInt(checkboxes[i].id.split("group-")[1]) < 100){
				checkboxes[i].checked = false;
			}
			
			// check the checkbox that has the matching name
			if(checkboxes[i].parentNode.innerText.includes(selected_value)){
				checkboxes[i].checked = true;
				
				// make that checkbox visible (dont make it visible for main-categories)
				if(show_checkboxes_after_checking){
					checkboxes[i].parentNode.style.display = "block";
				}
			}
		}
	}
}
</script>

{# 1. 渲染 main categories，按 object_type 区分 #}
{% if object_type == 'dataset' %}
    <label class="control-label" for="field-group">
        <span class="control-required">*</span> Main Categories (Datenset and Documents)
    </label>
    <div class="controls">
        <select id="field-group" name="groups__0__id" data-module="autocomplete">
            <option value="dataset">Dataset and Documents</option>
            <!-- 可继续添加 dataset schema 下的 main categories -->
        </select>
    </div>
    <br>
{% elif object_type == 'project' %}
    <label class="control-label" for="field-group">
        <span class="control-required">*</span> Main Categories (Project)
    </label>
    <div class="controls">
        <select id="field-group" name="groups__0__id" data-module="autocomplete">
            <option value="project">Project</option>
            <!-- 可继续添加 project schema 下的 main categories -->
        </select>
    </div>
    <br>
{% else %}
    <label class="control-label" for="field-group">
        <span class="control-required">*</span> Main Categories (默认)
    </label>
    <div class="controls">
        <select id="field-group" name="groups__0__id" data-module="autocomplete">
            {% for group in h.get_allowable_children_groups('main-categories') %}
                <option value="{{ group.id }}">{{ group.title }}</option>
            {% endfor %}
        </select>
    </div>
    <br>
{% endif %}

{# 2. Themen 主题分组，多选不变 #}
<label class="control-label" for="field-group"><span title="This field is required" class="control-required"></span>Themen</label>  Add commentMore actions

	{# checking if group is included in data.groups does for some reason not work in Jinja, hence the id check, again with an invisible label #}
	{% set group_ids = [] %}
	{% for group in data.groups %}
		<label class="control-label" for="field-group" style="display:none"><span title="abc" class="control-required"></span>{{ group_ids.append(group.id) }}</label>
	{%endfor %}

	{% for group in h.get_allowable_children_groups('topics') %}
		{% if group.id in group_ids %}
			<label class="checkbox" for="field-group-{{ loop.index0 + 100 }}">
				<input id="field-group-{{ loop.index0 + 100 }}" type="checkbox" name="groups__{{ loop.index0 + 100 }}__id" value="{{ group.id }}" checked=true/>{{ group.title }}
			</label>
		{% else %}
			<label class="checkbox" for="field-group-{{ loop.index0 + 100 }}" style="display:none">
				<input id="field-group-{{ loop.index0 + 100 }}" type="checkbox" name="groups__{{ loop.index0 + 100 }}__id" value="{{ group.id }}"/>{{ group.title }}
			</label>		
		{% endif %}
	{%endfor%}

	<div class="controls">
		<select id="field-group_2" name="groups__2__id" data-module="autocomplete" onclick="show_checkboxes(this)">
			<option value=""selected="selected">Bitte wählen Sie</option>
				{% for group in h.get_allowable_children_groups('topics') %}
					{% set existing_group_id = group.id %}
					{% if group.id not in group_ids %}
						<option value="{{ group.id }}" >{{ group.title }}</option>
					{% endif %}
				{% endfor %}
		</select>Add commentMore actions
	</div>

<br>

<div class="form-group">
    <div class="info-block">
        <i class="fa fa-info-circle"></i>
        {% trans %}
        Jeder Katalogeintrag ist genau einer "Hauptkategorie" zugeordnet. Die Zuordnung zu den Gruppen "Themen" ist optional, hier können auch mehr als eine Gruppe ausgewählt werden. Um einen besseren Überblick über die gesamten Gruppen zu haben, sehen Sie sich diese <a href="/group/">Seite</a> an.
        {% endtrans %}
    </div>
</div>
<hr/>
